<%- include('../../includes/head.ejs') %>
<link rel="stylesheet" type="text/css" href="/threejs/css/Qgis2threejs.css" />
<script src="/threejs/js/three.min.js"></script>
<script src="/threejs/js/OrbitControls.js"></script>
<script src="/threejs/js/OutlineEffect.js"></script>
<script src="/threejs/js/Qgis2threejs.js"></script>
<script src="/threejs/dat-gui/dat.gui.min.js"></script>
<script src="/threejs/dat-gui/dat-gui_panel.js"></script>
</head>

<body style="color: black">
  <div  id="view">
    <div id="northarrow"></div>
    <div id="navigation"></div>
  </div>

  <!-- popup -->
  <div id="popup">
    <div id="closebtn">&times;</div>
    <div id="popupbar"></div>
    <div id="popupbody">
      <div id="popupcontent"></div>

      <!-- query result -->
      <div id="queryresult">
        <table id="qr_coords_table">
          <caption>
            Clicked coordinates
            <div id="zoomtopoint" class="action-zoom zoombtn"></div>
          </caption>
          <tr>
            <td id="qr_coords"></td>
          </tr>
        </table>

        <table id="qr_layername_table">
          <caption>
            Layer
            <div id="zoomtolayer" class="action-zoom zoombtn"></div>
          </caption>
          <tr>
            <td id="qr_layername"></td>
          </tr>
        </table>

        <table id="qr_attrs_table">
          <caption>
            Attributes
          </caption>
        </table>

        <!-- camera actions and measure tool -->
        <div id="orbitbtn" class="action-btn action-orbit">Orbit</div>
        <div id="measurebtn" class="action-btn">Measure distance</div>
      </div>

      <!-- page info -->
      <div id="pageinfo">
        <h1>Current View URL</h1>
        <div><input id="urlbox" type="text" /></div>

        <h1>Usage</h1>
        <table id="usage">
          <tr>
            <td colspan="2" class="star">Mouse</td>
          </tr>
          <tr>
            <td>Left button + Move</td>
            <td>Orbit</td>
          </tr>
          <tr>
            <td>Mouse Wheel</td>
            <td>Zoom</td>
          </tr>
          <tr>
            <td>Right button + Move</td>
            <td>Pan</td>
          </tr>

          <tr>
            <td colspan="2" class="star">Keys</td>
          </tr>
          <tr>
            <td>Arrow keys</td>
            <td>Move Horizontally</td>
          </tr>
          <tr>
            <td>Shift + Arrow keys</td>
            <td>Orbit</td>
          </tr>
          <tr>
            <td>Ctrl + Arrow keys</td>
            <td>Rotate</td>
          </tr>
          <tr>
            <td>Shift + Ctrl + Up / Down</td>
            <td>Zoom In / Out</td>
          </tr>
          <tr>
            <td>L</td>
            <td>Toggle Label Visibility</td>
          </tr>
          <tr>
            <td>R</td>
            <td>Start / Stop Orbit Animation</td>
          </tr>
          <tr>
            <td>W</td>
            <td>Wireframe Mode</td>
          </tr>
          <tr>
            <td>Shift + R</td>
            <td>Reset Camera Position</td>
          </tr>
          <tr>
            <td>Shift + S</td>
            <td>Save Image</td>
          </tr>
        </table>

        <h1>About</h1>
        <div id="about">
          This page was made with <a href="https://www.qgis.org/">QGIS</a> and
          <a href="https://github.com/minorua/Qgis2threejs">Qgis2threejs</a>
          plugin (version 2.7.1).
          <div>
            Powered by <a href="https://threejs.org/">three.js</a>,
            <a href="https://code.google.com/p/dat-gui/">dat-gui</a>
            <span id="lib_proj4js">
              and <a href="https://trac.osgeo.org/proj4js/">Proj4js</a></span>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- progress bar -->
  <div id="progress">
    <div id="progressbar"></div>
  </div>

  <!-- header and footer -->
  <div id="header" class="d-flex flex-column align-items-start">
    <h3>Bristlecone Pine Risk Assessment at Great Basin National Park</h3>
    <a href="/" class="btn btn-primary mb-3">Back to Home</a>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#analysisModal">
      View Analysis
    </button>
  </div>

  <div class="position-fixed bottom-0 end-0 p-3">
    <img src="/3d-legend.png" alt="legend" width="150">
  </div>

  <div class="end-0" id="footer">
    <div class="credits text-center fs-6 text-muted">
      Â© 2023 Bristlecone Pine Risk Assessment Project | Created by Thomas Zhang
    </div>
  </div>
  
  <!-- Modal -->
  <div class="modal fade" id="analysisModal" tabindex="-1" aria-labelledby="analysisModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="analysisModalLabel">Great Basin National Park Risk Analysis</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <section>
            <p>
              The Great Basin National Park is home to 12 distinct groves of Great Basin Bristlecone Pines, collectively covering an area of 1794.64 acres. These groves are primarily located at elevations above 6000 feet, a testament to the species' adaptability to harsh, high-altitude conditions.
            </p>
            <p>
              In terms of risk assessment, all groves within the park boundaries are classified as having low to very low risk levels. This is a significant finding, as it indicates that the trees in these groves are less likely to be adversely affected by the key risk factors we've identified, including climate change, pests, fire, and human activity.
            </p>
            <p>
              The low risk levels observed in the Great Basin National Park can be attributed, in part, to the effective management strategies implemented by the National Park Service (NPS). The NPS has been instrumental in preserving the natural habitats of the Bristlecone Pines, implementing measures to mitigate the impact of human activity, and monitoring potential threats such as pests and diseases. Their efforts underscore the importance of active and informed management in preserving these ancient trees for future generations.
            </p>
          </section>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- animation -->
  <div id="narrativebox" class="ef1">
    <div id="narbody"></div>
    <div id="nextbtn"></div>
  </div>


  <script>
    Q3D.Config.localMode = true;
    Q3D.Config.northArrow.enabled = true;
    Q3D.Config.northArrow.color = 0x666666;

    var container = document.getElementById("view"),
      app = Q3D.application,
      gui = Q3D.gui;

    app.init(container); // initialize viewer

    // load the scene
    app.loadSceneFile(
      "/threejs/data/grba/index/scene.js",
      function (scene) {
        // scene file has been loaded
        app.start();

        gui.dat.initLayersFolder(scene);
      },
      function (scene) {
        // all relevant files have been loaded

        if (Q3D.Config.gui.customPlane) {
          var zMin = undefined,
            zMax = undefined;
          gui.dat.initCustomPlaneFolder(zMin, zMax);
        }
      }
    );
  </script>
  </body>

</html>